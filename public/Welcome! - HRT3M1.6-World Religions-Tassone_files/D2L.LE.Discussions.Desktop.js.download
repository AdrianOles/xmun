D2L.LE=D2L.LE||{};D2L.LE.Discussions=D2L.LE.Discussions||{PostClassName:'d2l-le-disc-post',UnapprovedClassName:'d2l-le-disc-post-unapproved',UnreadClassName:'d2l-le-disc-post-unread',HeadingClassName:'d2l-heading.d2l-left',BoldClassName:'vui-heading-3',RegularClassName:'vui-heading-4',OffscreenClassName:'d2l-offscreen',TextBlockClassName:'d2l-textblock',HiddenClassName:'d2l-hidden',BatchReadLocation:'',TopicListPlaceHolderId:'',OnLoad:function(){if(window.location.hash){setTimeout(function(){window.location.href=window.location.href;});}},CalculatePaddingLoader:function(indentLevel,postId){D2L.LP.Web.UI.Events.OnResize.AddListener(function(){D2L.LE.Discussions.CalculatePadding(indentLevel,postId);});D2L.LE.Discussions.CalculatePadding(indentLevel,postId);},CalculatePadding:function(indentLevel,postId){var post=document.querySelector('[data-postid="'+postId+'"]');if(!post)return;var viewport=D2L.LP.Web.UI.Html.Dom.GetViewportSize(window);var dir=getComputedStyle(document.body).direction;var padding=10+indentLevel*45;if(viewport.width<554){var padding=10+indentLevel*20;}if(dir==='rtl'){post.style.paddingRight=padding+"px";}else{post.style.paddingLeft=padding+"px";}},ScrollToPost:function(postElementId){var buttonRect=D2L.LP.Web.UI.Html.Dom.GetBoundingRect(D2L.LP.Web.UI.Html.Dom.GetElementById(postElementId.GetValue()));var viewport=D2L.LP.Web.UI.Html.Dom.GetViewportSize(window);var top=buttonRect.top;var left=buttonRect.left;var width=buttonRect.right;var height=buttonRect.height;if(top+height>=window.pageYOffset&&left>=window.pageXOffset&&top+height<=window.pageYOffset+window.innerHeight-100&&left+width<=window.pageXOffset+window.innerWidth){return;}var scrollPos=Math.max(buttonRect.top+buttonRect.height-viewport.height,0);window.scroll(0,scrollPos+height+100);},ReloadSidebarItemsFunction:null,ReloadSidebarFunction:null,InitReloadFunction:function(reloadSidebarItemsFunction,reloadSidebarFunction,topicListTreePlaceholderId){this.TopicListPlaceHolderId=topicListTreePlaceholderId;if(reloadSidebarItemsFunction){D2L.LE.Discussions.ReloadSidebarItemsFunction=reloadSidebarItemsFunction;}if(reloadSidebarFunction){D2L.LE.Discussions.ReloadSidebarFunction=reloadSidebarFunction;}},ReloadSidebar:function(){var topicListPlaceholder=D2L.LP.Web.UI.Html.Dom.GetElementById(this.TopicListPlaceHolderId);if(D2L.LE.Discussions.ReloadSidebarFunction&&topicListPlaceholder){D2L.LE.Discussions.ReloadSidebarFunction();}},ReloadSidebarItems:function(){var topicListPlaceholder=D2L.LP.Web.UI.Html.Dom.GetElementById(this.TopicListPlaceHolderId);if(D2L.LE.Discussions.ReloadSidebarItemsFunction&&topicListPlaceholder){D2L.LE.Discussions.ReloadSidebarItemsFunction();}},ReloadSidebarSettings:function(){window.location.reload();}};D2L.LP.Web.UI.Events.OnLoad.AddListener(D2L.LE.Discussions.OnLoad);D2L.LE=D2L.LE||{};D2L.LE.Discussions=D2L.LE.Discussions||{};D2L.LE.Discussions.ThreadViewData={Data:null};D2L.LE=D2L.LE||{};D2L.LE.Discussions=D2L.LE.Discussions||{};D2L.LE.Discussions.ThreadViewStyle=D2L.LE.Discussions.ThreadViewStyle||{Init:function(){this.Data=D2L.LE.Discussions.ThreadViewData.Data;},StylePostUnread:function(containerId,textUnreadId,contextMenuId){var container=D2L.LP.Web.UI.Html.Dom.GetElementById(containerId.GetValue());if(container===null){return;}D2L.LP.Web.UI.Desktop.Controls.ContextMenu.SetItemIsVisible(contextMenuId,'read',true);D2L.LP.Web.UI.Desktop.Controls.ContextMenu.SetItemIsVisible(contextMenuId,'unread',false);var readNodes=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName(this.Data.PostClassName,container);for(var i=0;i<readNodes.length;i++){var me=D2L.LE.Discussions.ThreadViewStyle;$(function(){$.AnimateScrollSpy=function(){$(readNodes[i]).switchClass('',me.Data.UnreadClassName,me.Data.ScrollSpyTransitionSpeed);};$.AnimateScrollSpy();});}var headingNodes=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName(this.Data.HeadingClassName,container);for(var i=0;i<headingNodes.length;i++){D2L.LP.Web.UI.Html.Dom.RemoveClassName(this.Data.RegularClassName,headingNodes[i]);D2L.LP.Web.UI.Html.Dom.AddClassName(this.Data.BoldClassName,headingNodes[i]);}D2L.LP.Web.UI.Html.Dom.SetIsDisplayed(textUnreadId,true);},StylePostRead:function(containerId,textUnreadId,contextMenuId){var container=D2L.LP.Web.UI.Html.Dom.GetElementById(containerId.GetValue());if(container===null){return;}var me=D2L.LE.Discussions.ThreadViewStyle;D2L.LP.Web.UI.Desktop.Controls.ContextMenu.SetItemIsVisible(contextMenuId,'read',false);D2L.LP.Web.UI.Desktop.Controls.ContextMenu.SetItemIsVisible(contextMenuId,'unread',true);var unreadNodes=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName(me.Data.UnreadClassName,container);for(var i=0;i<unreadNodes.length;i++){$(function(){$.AnimateScrollSpy=function(){$(unreadNodes[i]).switchClass(me.Data.UnreadClassName,'',me.Data.ScrollSpyTransitionSpeed);};$.AnimateScrollSpy();});}var headingNodes=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName(me.Data.HeadingClassName,container);for(var i=0;i<headingNodes.length;i++){D2L.LP.Web.UI.Html.Dom.RemoveClassName(me.Data.BoldClassName,headingNodes[i]);D2L.LP.Web.UI.Html.Dom.AddClassName(me.Data.RegularClassName,headingNodes[i]);}D2L.LP.Web.UI.Html.Dom.SetIsDisplayed(textUnreadId,false);}};D2L.LE=D2L.LE||{};D2L.LE.Discussions=D2L.LE.Discussions||{};D2L.LE.Discussions.ThreadViewSidebar=D2L.LE.Discussions.ThreadViewSidebar||{Init:function(){this.Data=D2L.LE.Discussions.ThreadViewData.Data;this.SetupUnreadCountUpdate();},FixUnreadCounts:function(){var evt=D2L.LP.Web.UI.Rpc.ConnectObject(D2L.LP.Web.UI.Rpc.Verbs.GET,new D2L.LP.Web.Http.UrlLocation(this.Data.GetUnreadCountsLocation));evt.AddListener(function(countString){countString=countString.split(' ');var me=D2L.LE.Discussions.ThreadViewSidebar;me.Data.ForumUnreadCount=parseInt(countString[0]);me.Data.TopicUnreadCount=parseInt(countString[1]);me.UpdateUnreadCounts();});},SetupUnreadCountUpdate:function(){setInterval(function(){var me=D2L.LE.Discussions.ThreadViewSidebar;me.UpdateUnreadCounts();},this.Data.SidebarSyncInterval);},UpdateUnreadCounts:function(){this.UpdateUnreadCount(this.Data.TopicTreeUnreadTextId,this.Data.TopicTreeItemId,this.Data.TopicUnreadCount);this.UpdateUnreadCount(this.Data.ForumTreeUnreadTextId,this.Data.ForumTreeItemId,this.Data.ForumUnreadCount);},UpdateUnreadCount:function(unreadTreeTextId,treeItemId,newUnreadCount){if(!D2L.LP.Web.UI.Html.Dom.GetElementById(this.Data.TopicListId)){return;}var unreadTreeText=D2L.LP.Web.UI.Html.Dom.GetElementById(unreadTreeTextId);var currentUnreadCount=parseInt(unreadTreeText.textContent||unreadTreeText.innerText);if(currentUnreadCount==newUnreadCount){return;}if(unreadTreeText.textContent){unreadTreeText.textContent=newUnreadCount;}else if(unreadTreeText.innerText){unreadTreeText.innerText=newUnreadCount;}if(newUnreadCount==0){var topicTreeItem=D2L.LP.Web.UI.Html.Dom.GetElementById(treeItemId);var textNodes=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName(this.Data.StrongClassName,topicTreeItem);for(var i=0;i<textNodes.length;i++){D2L.LP.Web.UI.Html.Dom.RemoveClassName(this.Data.StrongClassName,textNodes[i]);}}else if(currentUnreadCount==0){var topicTreeItem=D2L.LP.Web.UI.Html.Dom.GetElementById(treeItemId);var textNodes=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName(this.Data.TextBlockClassName,topicTreeItem);for(var i=0;i<textNodes.length;i++){if(!$(textNodes[i]).hasClass(this.Data.OffscreenClassName)){D2L.LP.Web.UI.Html.Dom.AddClassName(this.Data.StrongClassName,textNodes[i]);}}}}};D2L.LE=D2L.LE||{};D2L.LE.Discussions=D2L.LE.Discussions||{};D2L.LE.Discussions.ThreadViewBatch=D2L.LE.Discussions.ThreadViewBatch||{BatchList:new Array(),DontAddList:new Array(),Init:function(){this.Data=D2L.LE.Discussions.ThreadViewData.Data;this.SetupBatching();},SetupBatching:function(){setInterval(function(){var me=D2L.LE.Discussions.ThreadViewBatch;me.Send();},this.Data.BatchInterval);},CanAdd:function(postId){return!this.Contains(this.DontAddList,postId);},Add:function(postId){if(this.CanAdd(postId)){this.BatchList.push(postId);this.DontAddList.push(postId);}},Remove:function(postId){this.RemoveElement(this.BatchList,postId);this.RemoveElement(this.DontAddList,postId);},Send:function(){if(this.BatchList.length>0){D2L.LP.Web.UI.Rpc.Connect(D2L.LP.Web.UI.Rpc.Verbs.POST,new D2L.LP.Web.Http.UrlLocation(this.Data.MarkRepliesReadLocation),{'replyIds':this.BatchList});this.Clear();}},Clear:function(){this.BatchList=new Array();},Reset:function(){this.BatchList=new Array();this.DontAddList=new Array();},Contains:function(arr,elem){for(var i=0;i<arr.length;i++){if(elem==arr[i]){return true;}}return false;},RemoveElement:function(arr,elem){for(var i=0;i<arr.length;i++){if(elem==arr[i]){arr.splice(i,1);}}}};D2L.LE=D2L.LE||{};D2L.LE.Discussions=D2L.LE.Discussions||{};D2L.LE.Discussions.ThreadView=D2L.LE.Discussions.ThreadView||{Batch:D2L.LE.Discussions.ThreadViewBatch,Style:D2L.LE.Discussions.ThreadViewStyle,Sidebar:D2L.LE.Discussions.ThreadViewSidebar,Init:function(){this.Data=D2L.LE.Discussions.ThreadViewData.Data;},MarkUnread:function(postId,containerId,textUnreadId,contextMenuId,markUnreadLocation){this.Batch.Remove(postId);this.Style.StylePostUnread(containerId,textUnreadId,contextMenuId);this.Data.TopicUnreadCount+=+1;this.Data.ForumUnreadCount+=1;this.Sidebar.UpdateUnreadCounts();D2L.LP.Web.UI.Rpc.Connect(D2L.LP.Web.UI.Rpc.Verbs.POST,markUnreadLocation);},MarkRead:function(postId,containerId,textUnreadId,contextMenuId){if(!this.Batch.CanAdd(postId)){return;}this.Batch.Add(postId);this.Batch.Send();this.Data.TopicUnreadCount-=1;this.Data.ForumUnreadCount-=1;this.Sidebar.UpdateUnreadCounts();this.Style.StylePostRead(containerId,textUnreadId,contextMenuId);},MarkAllPostsAsRead:function(containerId){var me=D2L.LE.Discussions.ThreadView;this.Batch.Reset();var container=D2L.LP.Web.UI.Html.Dom.GetElementById(containerId);if(container===null){return;}var postNodes=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName(me.Data.PostClassName,container);for(var j=0;j<postNodes.length;j++){var postId=this.GetAttributeValue(postNodes[j],'data-postId').GetValue();this.Batch.Add(postId);}this.Batch.Send();for(var i=0;i<postNodes.length;i++){var contextMenuId=this.GetAttributeValue(postNodes[i],'data-contextMenuId');var postUnreadTextId=this.GetAttributeValue(postNodes[i],'data-postUnreadTextId');var contentsPlaceHolderId=this.GetAttributeValue(postNodes[i],'data-contentsPlaceHolderId');this.Style.StylePostRead(contentsPlaceHolderId,postUnreadTextId,contextMenuId);}this.Sidebar.FixUnreadCounts();},GetAttributeValue:function(node,attrName){var attributeValue;if(D2L.LP.Web.UI.Html.Dom.HasAttribute(node,attrName)){attributeValue=D2L.LP.Web.UI.Html.AbsoluteHtmlId.Create(D2L.LP.Web.UI.Html.Dom.GetAttribute(node,attrName));}return attributeValue;},GetPostId:function(){return this.Data.PostId;},GetThreadId:function(){return this.Data.ThreadId;},GetOrgUnitId:function(){return this.Data.OrgUnitId;},CallRepositoryFunction:function(functionName){var func=D2L.LP.Web.UI.ObjectRepository.TryGet(functionName);if(func){func.call(func);}},MarkAllUnread:function(){this.CallRepositoryFunction('mark-all-unread-thread');},MarkAllRead:function(){this.CallRepositoryFunction('mark-all-read-thread');},Flag:function(postId){this.Batch.Send();this.Data.PostId=postId;this.CallRepositoryFunction('flag-post');},Approve:function(postId){this.Batch.Send();this.Data.PostId=postId;this.CallRepositoryFunction('approve-post');},Unapprove:function(postId){this.Batch.Remove(postId);this.Batch.Send();this.Data.PostId=postId;this.CallRepositoryFunction('unapprove-post');},Delete:function(postId){this.Batch.Remove(postId);this.Batch.Send();this.Data.PostId=postId;this.CallRepositoryFunction('delete-post');},Copy:function(postId){this.Data.PostId=postId;this.CallRepositoryFunction('copy-post');},GetDataListItemId:function(){return new D2L.LP.Web.UI.Html.AbsoluteHtmlId('postDataListItem_'+this.Data.PostId);}};D2L.LE=D2L.LE||{};D2L.LE.Discussions.History=D2L.LE.Discussions.History||{m_notSupported:history.pushState===undefined,m_navigationEventHandlers:[],m_queryParams:null,AddOnNavigateHandler:function(callback){if(this.m_notSupported)return;this.m_navigationEventHandlers.push(callback);},GetValue:function(key,defaultValue){if(this.m_notSupported)return;var queryParams=this._parseQueryString();if(key in queryParams){return queryParams[key];}var state=history.state;if(state&&key in state){return state[key];}return defaultValue;},PushPage:function(title,location){if(this.m_notSupported)return;title=title||document.title;location=location||document.location.href;var state=history.state;history.pushState(state,title,location);},RemoveValue:function(key,newPage,updateQueryString){if(this.m_notSupported)return;var state=history.state;var queryParams=this._parseQueryString();if(state)delete state[key];delete queryParams[key];this._navigate(state,queryParams,newPage,updateQueryString);},StoreValue:function(key,value,newPage,updateQueryString){if(this.m_notSupported)return;var state=history.state||{};state[key]=value;this._navigate(state,null,newPage,updateQueryString);},_parseQueryString:function(){if(this.m_queryParams){return this.m_queryParams;}var queryString=location.search.substr(1);if(queryString.length<=0){return{};}var queryParams={};var queryParts=queryString.split('&');for(var i in queryParts){var parts=queryParts[i].split('=',2);var key=decodeURIComponent(parts[0]),value=decodeURIComponent(parts[1]);if(key in queryParams){if(Array.isArray(queryParams[key])){queryParams[key].push(value);}else{queryParams[key]=[queryParams[key],value];}}else{queryParams[key]=value;}}return queryParams;},_navigate:function(state,queryParams,newPage,updateQueryString){queryParams=queryParams||this._parseQueryString();newPage=newPage||false;updateQueryString=updateQueryString===undefined?true:updateQueryString;var location=document.location.href;if(updateQueryString){if(state){for(var param in state){queryParams[param]=state[param];}}var queryString=$.param(queryParams,true);location=queryString?'?'+queryString:document.location.href.replace(document.location.search,'');}if(newPage){history.pushState(state,document.title,location);}else{history.replaceState(state,document.title,location);}},_handleOnPopState:function(event){var me=D2L.LE.Discussions.History;me.m_queryParams=me._parseQueryString();var eventHandlers=me.m_navigationEventHandlers;for(var i in eventHandlers){eventHandlers[i].call();}me.m_queryParams=null;}};window.onpopstate=D2L.LE.Discussions.History._handleOnPopState;D2L.LE=D2L.LE||{};D2L.LE.Discussions=D2L.LE.Discussions||{};D2L.LE.Discussions.DiscussionSelectAll=D2L.LE.Discussions.DiscussionSelectAll||{OnSelectionUpdateEvents:{},GetSelectAllIdByDiscussionSelectAllId:function(discussionSelectAllId){var discussionSelectAllNode=D2L.LP.Web.UI.Html.Dom.GetElementById(discussionSelectAllId.GetValue());var selectAllNode=D2L.LP.Web.UI.Html.Dom.GetFirstImmediateChildElementByClassName('d2l-selectall',discussionSelectAllNode);if(selectAllNode==null){return null;}return new D2L.LP.Web.UI.Html.AbsoluteHtmlId(selectAllNode.getAttribute('id'));},GetEvent:function(id,events){var evt=events[id];if(evt===undefined){evt=new D2L.LP.Web.UI.Events.Event();events[id]=evt;}return evt;},GetSelectionUpdatedEvent:function(id){var me=D2L.LE.Discussions.Web.Desktop.Controls.DiscussionSelectAll.DiscussionSelectAll;return me.GetEvent(id.GetValue(),me.OnSelectionUpdatedEvents);}};D2L.LE=D2L.LE||{};D2L.LE.Discussions=D2L.LE.Discussions||{};D2L.LE.Discussions.RelativeToAbsoluteIdConverter=D2L.LE.Discussions.RelativeToAbsoluteIdConverter||{GetConvertedId:function(converterId){var convertedIdString=D2L.LP.Web.UI.Desktop.Controls.Hidden.GetValue(converterId);return new D2L.LP.Web.UI.Html.AbsoluteHtmlId(convertedIdString);}};D2L.LP.Web.UI.Html.Dom.AddClassInitializer('d2l-discussionselectall',function(node){var selectAllNode=D2L.LP.Web.UI.Html.Dom.GetFirstElementByClassName('d2l-selectall',node);if(selectAllNode==null){return;}var selectAllId=new D2L.LP.Web.UI.Html.AbsoluteHtmlId(selectAllNode.getAttribute('id'));var dataList=D2L.LP.Web.UI.Desktop.Controls.DataList;var dataListNode=D2L.LP.Web.UI.Html.Dom.GetFirstElementByClassName('d2l-datalist-container');var dataListId=new D2L.LP.Web.UI.Html.AbsoluteHtmlId(dataListNode.getAttribute('id'));var listNode=D2L.LP.Web.UI.Html.Dom.GetFirstImmediateChildElementByClassName('d2l-datalist',dataListNode);node.d2l_onRemoveItemHandler=function(itemNode){D2L.LP.Web.UI.Desktop.Controls.SelectAll.RemoveItem(selectAllId,dataList.CheckboxItems.GetCheckboxNode(itemNode).value);};dataList.GetOnRemoveItemEvent(dataListId).AddListener(node.d2l_onRemoveItemHandler);var clearLinkNode=D2L.LP.Web.UI.Html.Dom.GetFirstElementByClassName('d2l-discussionselectall-clear',node);var allSelectedTextNode=D2L.LP.Web.UI.Html.Dom.GetFirstElementByClassName('d2l-discussionselectall-all-selected',node);var noneSelectedTextNode=D2L.LP.Web.UI.Html.Dom.GetFirstElementByClassName('d2l-discussionselectall-notall-selected',node);node.d2l_updateSelectAllVisibilityHandler=function(){var isMultiSelectAlllowed=D2L.LP.Web.UI.Html.Dom.GetFirstImmediateChildElementByClassName('d2l-datalist-checkboxitem',listNode)!=null;if(!isMultiSelectAlllowed&&!D2L.LP.Web.UI.Html.Dom.HasClassName('d2l-hidden',selectAllNode)){D2L.LP.Web.UI.Html.Dom.AddClassName('d2l-hidden',selectAllNode);return;}if(isMultiSelectAlllowed&&D2L.LP.Web.UI.Html.Dom.HasClassName('d2l-hidden',selectAllNode)){D2L.LP.Web.UI.Html.Dom.RemoveClassName('d2l-hidden',selectAllNode);return;}};dataList.GetOnLoadCompletedEvent(dataListId).AddListener(node.d2l_updateSelectAllVisibilityHandler);dataList.GetOnLoadMoreCompletedEvent(dataListId).AddListener(node.d2l_updateSelectAllVisibilityHandler);dataList.GetOnRemoveItemEvent(dataListId).AddListener(node.d2l_updateSelectAllVisibilityHandler);var selectionUpdatedEvent=dataList.Summary.GetSelectionUpdatedEvent(dataListId);node.d2l_selectionUpdateHandler=function(type,count){var selectionInfo=D2L.LP.Web.UI.Desktop.Controls.SelectAll.GetSelectionInfo(selectAllId);if(selectionInfo!=null){selectionUpdatedEvent.Trigger(selectionInfo);}var checkboxNode=D2L.LP.Web.UI.Desktop.Controls.SelectAll.GetCheckboxNode(selectAllNode);if(type==D2L.LP.LayeredArch.SelectionFilterType.All||checkboxNode.checked){D2L.LP.Web.UI.Html.Dom.AddClassName('d2l-hidden',noneSelectedTextNode);D2L.LP.Web.UI.Html.Dom.RemoveClassName('d2l-hidden',allSelectedTextNode);if(clearLinkNode!=null){D2L.LP.Web.UI.Html.Dom.RemoveClassName('d2l-hidden',clearLinkNode);}}else if(type==D2L.LP.LayeredArch.SelectionFilterType.Some){D2L.LP.Web.UI.Html.Dom.RemoveClassName('d2l-hidden',noneSelectedTextNode);setTimeout(function(){D2L.LP.Web.UI.Html.Dom.AddClassName('d2l-hidden',allSelectedTextNode);},0);if(clearLinkNode!=null){D2L.LP.Web.UI.Html.Dom.RemoveClassName('d2l-hidden',clearLinkNode);}}else if(type==D2L.LP.LayeredArch.SelectionFilterType.None){setTimeout(function(){D2L.LP.Web.UI.Html.Dom.AddClassName('d2l-hidden',allSelectedTextNode);},0);if(clearLinkNode!=null){D2L.LP.Web.UI.Html.Dom.AddClassName('d2l-hidden',clearLinkNode);}if(noneSelectedTextNode!=null){D2L.LP.Web.UI.Html.Dom.RemoveClassName('d2l-hidden',noneSelectedTextNode);}}};D2L.LP.Web.UI.Desktop.Controls.SelectAll.GetOnSelectionUpdateEvent(selectAllId).AddListener(node.d2l_selectionUpdateHandler);});